steps:
- task: AzurePowerShell@3
  displayName: 'Pester testing with Azure'
  inputs:
    azureSubscription: AzureConnection
    ScriptType: InlineScript
    Inline: |
      $outputFile = "$(Build.SourcesDirectory)\TEST-RESULTS.xml"
      Invoke-Pester -Script @{
      Path =  '$(Build.SourcesDirectory)\Tests\AzureTesting\pipelinetest.ps1'
      Parameters = @{
      TemplatePath = '$(Build.SourcesDirectory)\Tests\AzureTesting'
      }
      } -OutputFile $outputFile -OutputFormat NUnitXml -enableExit
    FailOnStandardError: false
    azurePowerShellVersion: LatestVersion
- task: PublishTestResults@2
  displayName: 'Publish Online Test Results'
  inputs:
    testRunTitle: 'online Pester Results Azure'
    buildPlatform: 'Azure'
    testRunner: 'NUnit'
    testResultsFiles: './TEST-RESULTS.xml'
    failTaskOnFailedTests: true
